<script type="text/javascript">
  function useSpell(spellUsed, attack, spellDamage, damage, spellWeapon)
  {
  	 var spell = document.getElementById("spellPicked");
	 spell.value = spellUsed;
	 var atkResult = document.getElementById("attackResult");
  	 atkResult.value = Math.floor(attack + Math.random()*21);
	 var damResult = document.getElementById("damageResult");
	 var dmg = 0;
	 for(var counter = 0; counter < spellWeapon; counter++){
	 	dmg += Math.floor(1 + Math.random()*damage);		
	 }
  	 damResult.value = spellDamage + dmg;
  }
</script>

<h1>Player SpellBook</h1>

<form>
<table border="1">
	<% @player = Player.find(:first, :conditions => ["id = ?", session[:p_id]]) %>
  <tr>
  	<th colspan=3><%= @player.character_name %></th>
  </tr>
  <tr>
    <th>Spell</th>
    <th>Show</th>
    <th>Remove</th>
  </tr>
    <% @locateWeapon = PlayerInventory.find(:all, :conditions => ["player_id = ?", session[:p_id]]) %>
    <% @locateWeapon.each do |findWeapon|%>
		<% @weapon = Inventory.find(:first, :conditions => ["id = ? and item_type = ?", findWeapon.inventory_id, "Weapon"]) %>
		<% if @weapon %>
			<% @foundWeapon = @weapon %>
		<% end %>
	<% end %>
	
	<% @player_spells = PlayerSpell.find(:all, :conditions => ["player_id = ?", session[:p_id]])%>

<% @player_spells.each do |player_spell| %>
  <tr>
	<% spell = Spell.find(:first, :conditions => ["id = ?", player_spell.spell_id]) %>
    <td><%= spell.spell_name %></td>
	<% if spell.spell_modone == "dex" %>
		<% spell_damage = spell.spell_damage + session[:dex] %>
		<!-- to do add rest -->
	<% end %>
    <td><%= link_to 'Show', {:controller => "spells", :action => :show, :id => player_spell.spell_id} %></td>
    <td><%= link_to 'Destroy', player_spell, :confirm => 'Are you sure?', :method => :delete %></td>
	<td><input type="button" onclick="useSpell('<%= spell.spell_name %>', <%= spell.spell_attack %>, <%= spell_damage %>, <%= @foundWeapon.damage %>, <%= spell.spell_weapon %>)" value="Use Spell" /></td>
  </tr>
<% end %>
	<tr>
	  	<th>Used spell <input type="text" readonly=true style="text-align:center;" id="spellPicked"/></th>
		<th>Attack: <input type="text" id="attackResult" readonly=true style="text-align:center;"/></th>
		<th>Damage: <input type="text" id="damageResult" readonly=true style="text-align:center;"/></th>
	</tr>
</table>
</form>
<br />

<%= link_to 'Add Spell', {:controller => "spells", :action => :list, :id => @player.character_class} %>
<%= link_to 'Character', player_path(:id => session[:p_id]) %>
