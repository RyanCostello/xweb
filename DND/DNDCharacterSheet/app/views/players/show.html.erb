<script type="text/javascript">
  function skillCheck(skillUsed, num)
  {
  	 var skill = document.getElementById("skillPicked");
	 skill.value = skillUsed;
	 var ansD = document.getElementById("answer");
  	 ansD.value = Math.floor(num + 1 + Math.random()*20);
  }
</script>

<p id="notice"><%= notice %></p>
<h3>Character:&#160;<u><%= @player.character_name %></u>
	&#160;&#160;Class:&#160;<u><%= @player.character_class %></u>
	&#160;&#160;Level:&#160;<u><%= @player.character_level%></u>
	&#160;&#160;Initiative:&#160;<u><%= @player.character_initiative %></u></h3>
<table>
	<tr>
	<td colspan=2; style="float: left; margin: 20px 50px 20px 400px;">
		<table border=1>
			<tr>
				<th colspan=2>Abilities</th>
			</tr>
			  <th>Strength:</th>
			  <td><%= @player.strength %></td>
			</tr>
			<tr>
			  <th>Constitution:</th>
			  <td><%= @player.constitution %></td>
			</tr>
			<tr>
			  <th>Dexterity:</th>
			  <td><%= @player.dexterity %></td>
			</tr>
			<tr>
			  <th>Intellect:</th>
			  <td><%= @player.intellect %></td>
			</tr>
			<tr>
			  <th>Wisdom:</th>
			  <td><%= @player.wisdom %></td>
			</tr>
			<tr>
			  <th>Charisma:</th>
			  <td><%= @player.charisma %></td>
			</tr>
		</table>
	</td>
<% @defense = Defense.find(:first, :conditions => "player_id = '#{session[:p_id]}'") %>
<% @skill = Skill.find(:first, :conditions => "player_id = '#{session[:p_id]}'") %>
<% @things = PlayerInventory.find(:all, :conditions => "player_id = '#{session[:p_id]}'") %>

<% ac = 0 %>
<% if !@defense %>
	<% if @player.character_class == "Rogue" or @player.character_class == "Mage" or @player.character_class == "Warlock" or
			@player.character_class == "Cleric"%>
			<% if session[:dex_mod] > session[:int_mod] %>
				<% ac = session[:dex_mod] %>
			<% else %>
					<% ac = session[:int_mod] %> 
			<% end %>
	<% end %>
	<% if session[:str_mod] > session[:con_mod] %>
		<% fort = session[:str_mod]%>
		<% else %>
			<% fort = session[:con_mod] %>
	<% end %>
	<% if session[:dex_mod] > session[:int_mod] %>
		<% ref = session[:dex_mod]%>
		<% else %>
			<% ref = session[:int_mod] %>
	<% end %>
	<% if session[:wis_mod] > session[:char_mod] %>
		<% will = session[:wis_mod]%>
		<% else %>
			<% will = session[:char_mod] %>
	<% end %>
	<% @defense = Defense.new(:AC => 10+ac, :Fort => 10+fort, 
		:Reflex => 10+ref, :Will => 10+will, :player_id => @player.id) %>
	<% @defense.save %>
<% end %>
<% if !@skill %>
	<% @skill = Skill.new(:Athletics => session[:str_mod], :Acrobatics => session[:dex_mod], 
			:Stealth => session[:dex_mod], :Arcana => session[:int_mod], :player_id => @player.id,
			:History => session[:int_mod], :Religion => session[:int_mod], :Bluff => session[:char_mod],
			:Diplomacy => session[:char_mod], :Intimidate => session[:char_mod], :Streetwise => session[:char_mod],
			:Dungeoneering => session[:wis_mod], :Heal => session[:wis_mod], :Insight => session[:wis_mod],
			:Nature => session[:wis_mod], :Perception => session[:wis_mod], :Thievery => session[:dex_mod],
			:Endurance => session[:con_mod]) %>
	<% @skill.save %>
<% end %>
<td colspan=2; style="float: right; margin: 20px 50px 20px 50px;">
	<table border="1">
		<tr>
			<th colspan=2>Defenses</th>
		</tr>
		<tr>
		  <th>AC:</th>
		  <td><%= @defense.AC + (@player.character_level/2) + session[:ac] %></td>
		</tr>
		<tr>
		  <th>Fortitude:</th>
		  <td><%= @defense.Fort + (@player.character_level/2) + session[:fort] %></td>
		</tr>
		<tr>
		  <th>Reflex:</th>
		  <td><%= @defense.Reflex + (@player.character_level/2) + session[:ref] %></td>
		</tr>
		<tr>
		  <th>Will:</th>
		  <td><%= @defense.Will + (@player.character_level/2) + session[:will]%></td>
		</tr>
	</table>
</td>
<tr>
<td colspan=2; style="float: left; margin: 20px 50px 20px 400px;">
	<form>
	<table border="1">
	  <tr>
	  	<th colspan = "3"> Skills </th>
	  </tr>
	  <tr>
	  	<th>Acrobatics</th>
	    <td><%= @skill.Acrobatics + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Acrobatics', <%= @skill.Acrobatics + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th>Arcana</th>
		<td><%= @skill.Arcana + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Arcana', <%= @skill.Arcana + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th>Athletics</th>
		<td><%= @skill.Athletics + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Athletics', <%= @skill.Athletics + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th>Bluff</th>
		<td><%= @skill.Bluff + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Bluff', <%= @skill.Bluff + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Diplomacy</th>
		<td><%= @skill.Diplomacy + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Diplomacy', <%= @skill.Diplomacy + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th>Dungeoneering</th>
		<td><%= @skill.Dungeoneering + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Dungeoneering', <%= @skill.Dungeoneering + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Endurance</th>
		<td><%= @skill.Endurance + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Endurance', <%= @skill.Endurance + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th>Heal</th>
		<td><%= @skill.Heal + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Heal', <%= @skill.Heal + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>History</th>
		<td><%= @skill.History + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('History', <%= @skill.History + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Insight</th>
		<td><%= @skill.Insight + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Insight', <%= @skill.Insight + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Intimidate</th>
		<td><%= @skill.Intimidate + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Intimidate', <%= @skill.Intimidate + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Nature</th>
		<td><%= @skill.Nature + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Nature', <%= @skill.Nature + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Perception</th>
		<td><%= @skill.Perception + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Perception', <%= @skill.Perception + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Religion</th>
		<td><%= @skill.Religion + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Religion', <%= @skill.Religion + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Stealth</th>
		<td><%= @skill.Stealth + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Stealth', <%= @skill.Stealth + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>  
	  <tr>
	  	<th>Streetwise</th>
		<td><%= @skill.Streetwise + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Streetwise', <%= @skill.Streetwise + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th>Thievery</th>
		<td><%= @skill.Thievery + (@player.character_level/2) %></td>
		<td><input type="button" onclick="skillCheck('Thievery', <%= @skill.Thievery + (@player.character_level/2) %>)" value="Use Skill" /></td>
	  </tr>
	  <tr>
	  	<th colspan=3>Result from <input type="text" readonly=true style="text-align:center;" 
			id="skillPicked"/> skill check = <input type="text" id="answer" readonly=true style="text-align:center;"/></th>
	  </tr>
	</table>
	</form>
</td>
<td colspan=2; style="float: right; margin: 20px 50px 20px 50px;">
	<table border="1">
		<tr>
		  <th colspan=2>Defenses</th>
		</tr>
		<tr>
	  	<th></th>
		<td><%= @skill.Diplomacy + (@player.character_level/2) %></td>
	 	</tr>
		<tr>
		  <th>Fortitude:</th>
		  <td><%= @defense.Fort + (@player.character_level/2) %></td>
		</tr>
		<tr>
		  <th>Reflex:</th>
		  <td><%= @defense.Reflex + (@player.character_level/2) %></td>
		</tr>
		<tr>
		  <th>Will:</th>
		  <td><%= @defense.Will + (@player.character_level/2) %></td>
		</tr>
	</table>
</td>
</tr>
<tr>
	<td>
		<%= link_to 'Character List', players_path %>
	</td>
	<td>
		<%= link_to 'Inventory', player_inventories_path %>
	</td
	<td>
		<%= link_to 'Spells', player_spells_path %>
	</td
</tr>
</table>